<?xml version="1.0"?>
<xsl:stylesheet
     version="1.0"
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:output indent="yes" method="text" encoding="utf-8"/>

<xsl:param name='ns' select='/parameters/@namespace'/>
<xsl:param name='class' select='concat($ns, "Sensors")'/>

<xsl:template match="/">
/*********************************************************
 * AUTOGENERATED with ecuxml2cs.xsl!
 * DO NOT EDIT WITH HANDS!
 *********************************************************/
namespace hobd{

using System;

public class <xsl:value-of select='$class'/> : SensorProvider
{

    public <xsl:value-of select='$class'/>()
    {
    }
    
    public string GetName()
    {
        return "<xsl:value-of select='$class'/>";
    }

    public string GetDescription()
    {
        return "<xsl:value-of select='/parameters/@description'/>";
    }
    
    public string GetDescription(string lang)
    {
        return GetDescription();
    }

    public void Activate(SensorRegistry registry)
    {
        CoreSensor s;
        <xsl:apply-templates select='/parameters/parameter'/>
    }

    <xsl:apply-templates select='/parameters/parameter' mode='const'/>
}

}
/**
  List of PIDs generated:
<xsl:apply-templates select='/parameters/parameter' mode='list'/>
*/
</xsl:template>

<xsl:template match='parameter[address]'>
        // <xsl:value-of select='@id'/>
        s = new OBD2Sensor()
            {
                obdValue = (p) => { Func&lt;int, double&gt; get = p.get; Func&lt;int, int, double&gt; get_bit = p.get_bit;
                                    return <xsl:value-of select='normalize-space(value)'/>;
                                  },
                ID = "<xsl:value-of select='@id'/>",
                Command = <xsl:value-of select='address/byte'/>,
            };
        <xsl:apply-templates select='description'/>
        registry.Add(s);

</xsl:template>

<xsl:template match='parameter[class]'>
        // <xsl:value-of select='@id'/>
        s = new <xsl:value-of select='class'/>()
            {
                ID = "<xsl:value-of select='@id'/>",
            };
        <xsl:apply-templates select='description'/>
        registry.Add(s);

</xsl:template>

<xsl:template match='parameter/description'>
        s.SetName("<xsl:value-of select='@lang'/>", "<xsl:value-of select='name'/>");
        s.SetDescription("<xsl:value-of select='@lang'/>", "<xsl:value-of select='translate(description, &apos;&quot;&apos;, "&apos;")'/>");
        <xsl:if test='unit'>s.SetUnits("<xsl:value-of select='@lang'/>", "<xsl:value-of select='unit'/>");</xsl:if>
</xsl:template>

<xsl:template match='parameter' mode='const'>
  <xsl:variable name='cid' select='@id'/>
  
  public const string <xsl:choose>
     <xsl:when test='count(../parameter[@id = $cid]) > 1'>
       <xsl:value-of select='@id'/>_<xsl:value-of select='count(preceding-sibling::parameter[@id = $cid])'/>
     </xsl:when>
     <xsl:otherwise>
       <xsl:value-of select='@id'/>
     </xsl:otherwise>
  </xsl:choose> = "<xsl:value-of select='@id'/>";

</xsl:template>

<xsl:template match='parameter' mode='list'>
  - <xsl:value-of select='@id'/> - <xsl:value-of select='description/name'/> - <xsl:value-of select='description/description'/> - <xsl:value-of select='description/unit'/>
</xsl:template>

</xsl:stylesheet>
